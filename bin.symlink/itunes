#!/bin/bash

function tell() {
local doWhat="$*"
osascript -e 'tell application "iTunes"'\
      -e "$doWhat"\
      -e 'end tell'
}

function search() {
local term="$*"
local idsAndNames=$(osascript -e 'tell application "iTunes"'\
      -e "set the_tracks to search library playlist 1 for \"$term\""\
      -e 'set ids_and_names to {}'\
      -e 'repeat with the_track in the_tracks'\
      -e 'set ids_and_names to ids_and_names & ("" & (id of the_track) & ": " & (artist of the_track) & " - " & (name of the_track))'\
      -e 'end repeat'\
      -e 'return ids_and_names'\
      -e 'end tell')

IFS=','
for s in $idsAndNames; do
    echo -e "\t" ${s# }
done
}

cmd=$1

case $cmd in
    play) if [[ $# -eq 1 ]]; then
          tell $cmd
      else
          tell "$cmd track id $2 of library playlist 1"
      fi;;
    pause) tell $cmd;;
    next|back) tell "$cmd track";;
    search|find) shift; search "$*";;
esac

